.TH PROXY-NS 1 2026-01-06
.SH NAME
proxy-ns \- Force any program to use your SOCKS5 proxy server.
.SH SYNOPSYS
.B proxy-ns
.I [OPTIONS]
.I <command>
.I [COMMAND OPTIONS]
.SH OPTIONS
.SS General options
.TP
.B \-c
Path to configuration file, see
.B proxy-ns(5)
for details.
.TP
.B \-q
Quiet mode. By default, proxy-ns prints errors to standard error, this option makes proxy-ns redirects standard error to /dev/null at startup.
.TP
.B \-h, --help
Show help message.
.SS Overriding options
These options override settings in the configuration file:
.TP
.B --tun-name=<tun_name>
Set TUN device name.
.TP
.B --tun-ip=<tun_ip>
Set TUN device IPv4 address.
.TP
.B --tun-ip6=<tun_ip6>
Set TUN device IPv6 address.

Setting this option enables IPv6 default route in proxy-ns network namespace. Only set this option if your SOCKS5 server has IPv6 connectivity.
.TP
.B --socks5-address=<socks5_address>
Set the SOCKS5 server to use.
.TP
.B --username=<username>
Set the username of the specified SOCKS5 server.
.TP
.B --password=<password>
Set the password of the specified SOCKS5 server.
.TP
.B --fake-dns=<bool>_
Enable or disable fake DNS. See
.B NOTES ON FAKEDNS
for more details.
.TP
.B --fake-network=<fake_network>
Set the network used for fake DNS.

If
.B fake-dns
is enabled, and programs in proxy-ns network namespace makes a DNS request, an IP address from
.B fake-network
will be returned as response. The relationship between the domain name in request and the IP address returned will be saved, further accesses to the IP address will be recognized as accesses to the saved DNS name.
.TP
.B --dns-server=<dns_server>
Set DNS server.

DNS server used to resolve domain names. When
.B fake-dns
is enabled, it's only used for DNS requests
.B fake-dns
cannot handle: DNS message types other than A and AAAA.
.TP
.B --udp-session-timeout=<udp_session_timeout>
Set UDP session timeout.

.SH NOTES ON CAPABILITIES
.PP
.B cap_sys_admin
is for setns system call.
.PP
.B cap_net_admin
is for creating TUN device.
.PP
.B cap_net_bind_service
is for the FakeDNS server listening on 127.0.0.1:53.
.PP
.B cap_sys_chroot
is for setns into a new mount namespace.
.PP
.B cap_chown
is for
.B chown 0:0 /etc/resolv.conf.
.PP
All capabilities are dropped permanently before the program's main loop.

.SH NOTES ON FAKEDNS
.SS Advantages of FakeDNS:
.PP
1. Avoid an extra roundtrip for DNS.
.PP
2. Resolve DNS even when SOCKS5 server doesn't support UDP ASSOCIATE.
.SS Disadvantages of FakeDNS:
.PP
1. All domain names are resolved to
.B fake_network
, some programs may not work as expected(e.g. dig, geoiplookup).
.PP
2. Many SOCKS5 servers doesn't support
.B AtypDomainName
for UDP ASSOCIATE. If you enable FakeDNS, all UDP packets to domain names will be dropped.
(e.g. DNS may still work, but QUIC probably won't.)
.SS Caveats:
1. Some programs may not use your system DNS resolver. FakeDNS won't work for them.
.SH NOTES ON FORKING PROGRAMS
proxy-ns daemon program exits as the command exits, so if you start a forking program in proxy-ns, it will lose network connection.

If you start the forking program in shell, you can work around this problem by executing the shell in proxy-ns beforehand:

.IP
.B exec proxy-ns $SHELL

.SH SEE ALSO

.B proxy-ns(5)
